ABCL/c+ Language Specification
=================================

1. Overview
-----------
ABCL/c+ (Actor-Based Concurrent Language Plus) is a high-level, object-oriented and actor-oriented programming language designed for exploring concurrent computation, message passing, and class-based modeling. 
It is inspired by ABCL (Actor-Based Concurrent Language) but extends it with:

- Class-based syntax similar to Java/C++.
- Asynchronous message passing between actor instances.
- Dynamic evaluation and script execution through the REPL (abclrepl_thread).
- Thread-based runtime implemented in OCaml.

The language supports defining classes, creating objects, sending messages (method invocations), and managing state via fields.

2. Syntax and Grammar (Simplified)
----------------------------------
Program ::= ClassDef* GlobalStmt*

ClassDef ::= 'Class' ID '{' FieldDecl* MethodDecl* '}'
FieldDecl ::= ID '=' Expr
MethodDecl ::= ID '(' ParamList? ')' Block
ParamList  ::= ID (',' ID)*
Block      ::= 'Seq' Stmt*

Stmt ::= AssignStmt | CallStmt | SendStmt | VarDecl | Expr

Expr ::= Int | Float | String | Var ID | Binop Expr Expr | NewExpr | CallExpr

Binary Operators:
+  -  *  /   (numeric)
>  <  >= <= == !=   (comparison)
+  (string concatenation)

3. Example Programs
-------------------
Example 1: Hello Class

File: Hello.abcl
----------------
Class Hello {
  count = 0;

  init(n) {
    Seq
      Assign count = n;
      CallStmt print "Hello object initialized with " + n;
  }

  greet() {
    Seq
      CallStmt print "Hello! count = " + count;
  }

  inc() {
    Seq
      Assign count = count + 1;
      CallStmt print "count incremented to " + count;
  }
}

File: com12.bat
---------------
load Hello.abcl;
compile;
new Hello(5) -> h;
send h.greet;
send h.inc;
send h.greet;

Expected Output:
----------------
Hello object initialized with 5
Hello! count = 5
count incremented to 6
Hello! count = 6

4. Language Semantics
---------------------
Objects and Classes: Each Class defines a template for actors. Instances created by new ClassName(args) behave as independent actors.

Message Passing: The send operation enqueues a message (method invocation) to the target actor. Methods execute sequentially within an actor but actors themselves run concurrently.

Field Access: Fields are local to an actor and maintain per-actor state.

Expressions: Numeric operations are type-promoted (Int ↔ Float). String concatenation is implicit when using + with any string operand.

5. Runtime and Implementation
-----------------------------
Architecture:
- Implemented in OCaml with ocamlyacc and ocamllex for parsing.
- A threaded runtime (eval_thread.ml) for actors.
- AST representation (ast.ml), parser, and interpreter.

Directory Layout:
-----------------
ocaml-abcl18-v17/
├── src/
│   ├── parser.mly
│   ├── lexer.mll
│   ├── eval_thread.ml
│   ├── abclrepl_thread.ml
│   └── compiler.ml
├── examples/
│   ├── Hello.abcl
│   ├── com12.bat
└── Makefile

6. Development Guide
--------------------
Prerequisites:
- OCaml ≥ 5.1
- Dune ≥ 3.0 or GNU Make
- Thread library enabled

Install on macOS or Ubuntu:
---------------------------
opam switch create 5.1.1
opam install dune ocamlfind

Build and Run:
--------------
Using make inside the src directory:
make

This will generate the executable abclrepl_thread.

Example Run:
------------
cd examples
../src/abclrepl_thread -f com12.bat

Output:
-------
Compiler stub: compiler.ml
[Loaded] Hello.abcl
[Defined class Hello]
Hello object initialized with 5
Hello! count = 5
count incremented to 6
Hello! count = 6
[Script execution completed]
ABCL/c+> exit
Bye!

7. Interactive REPL
-------------------
Run interactively:
./abclrepl_thread

Then enter commands:
ABCL/c+> load Hello.abcl
ABCL/c+> compile
ABCL/c+> new Hello(10) -> h
ABCL/c+> send h.inc
ABCL/c+> exit

8. Development Notes
--------------------
- Thread model: Each object runs in its own OCaml thread.
- Synchronization: Message queues are implemented per-actor.
- Compilation mode: “compile” converts source to an intermediate AST and registers classes in the global environment.
- Logging: Use [info], [script], [Loaded] for execution trace.

9. Future Extensions
--------------------
- Static type inference (ML-like Hindley–Milner system)
- Networked actor communication
- Coq formalization for language soundness
- Visualization of actor message flow (Graphviz)
